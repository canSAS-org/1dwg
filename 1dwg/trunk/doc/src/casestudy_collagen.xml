<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbook.rng" type="xml"?>
<!-- 
    ########### SVN repository information ###################
    # $Date$
    # $Author$
    # $Revision$
    # $HeadURL$
    # $Id$
    ########### SVN repository information ###################
-->
<!-- from: http://www.smallangles.net/wgwiki/index.php/cansas1d_SASroot -->
<section xml:id="cansas1d_documentation-case_study-collagen" xmlns="http://docbook.org/ns/docbook"
    version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>Case Study: Dry Chick Collagen</title>
    <section>
        <title>Overview</title>
        <indexterm significance="preferred">
            <primary>case study</primary>
            <secondary>SAXS of dry chick collagen</secondary>
        </indexterm>
        <para> To demonstrate how to get SAS data into the XML standard format, consider this set of
            SAXS data collected at the National Synchrotron Light Source, Brookhaven National
            Laboratory, using a SAXS camera set up temporarily at beam line X6B (operated by the
            Materials Science Division, Argonne National Lab). </para>
        <para> The sample was <emphasis role="bold">dry chick collagen.</emphasis> (Thanks to
            Malcolm Capel, NSLS beam line X12C for the sample.) </para>
        <para>
            <informaltable>
                <!--<title>Figures for dry chick collagen case study</title>-->
                <tgroup cols="2">
                    <tbody>
                        <row>
                            <entry>
                                <mediaobject>
                                    <imageobject>
                                        <imagedata
                                            fileref="../../graphics/cs-collagen-data-table-Excel.jpg"
                                            width="150pt" scalefit="1"/>
                                    </imageobject>
                                    <caption>
                                        <para>collagen SAXS in Excel table</para>
                                    </caption>
                                </mediaobject>
                            </entry>
                            <entry>
                                <mediaobject>
                                    <imageobject>
                                        <imagedata
                                            fileref="../../graphics/cs-collagen-saxs-chart-excel.jpg"
                                            width="150pt" scalefit="1"/>
                                    </imageobject>
                                    <caption>
                                        <para>collagen SAXS in Excel chart (log-log)</para>
                                    </caption>
                                </mediaobject>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </informaltable>
        </para>
        <para> The raw data 
            was collected on a linear position-sensitive detector and reduced to
            columns of <emphasis role="bold">Q</emphasis>, <emphasis role="bold">I</emphasis>, and
                <emphasis role="bold">Iesd</emphasis> (estimated standard deviation of <emphasis
                role="bold">I</emphasis>). </para>
        <para> The only metadata available for this data (without resorting to digging through piles
            of old notebooks) was obtained from two file headers: 
            <link
                xlink:href="http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/examples/collagen/COLLAGEN.ASC"
                ><citetitle>collagen.asc</citetitle>
            </link><footnote><para><link
                xlink:href="http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/examples/collagen/COLLAGEN.ASC"
                ><literal>http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/examples/collagen/COLLAGEN.ASC</literal>
            </link></para></footnote>
            and
            <link
                xlink:href="http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/examples/collagen/collagen.saxs"
                ><citetitle>collagen.saxs</citetitle>
            </link><footnote><para><link
                xlink:href="http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/examples/collagen/collagen.saxs"
                ><literal>http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/examples/collagen/collagen.saxs</literal>
            </link></para></footnote>
            as shown.
        </para>
        <para>
            <example>
                <title>First few lines from file <citetitle>collagen.asc</citetitle></title>
            <programlisting>Sep 19 1994     01:41:02 am     Elt: 00090 Seconds 
ID: No spectrum identifier defined
Memory Size: 8192 Chls  Conversion Gain: 1024  Adc Offset: 0000 Chls        </programlisting>
            </example>
            <example>
                <title>Full listing of file <citetitle>collagen.saxs</citetitle></title>
                <programlisting>dry chick collagen, d = 673 A
6531 eV, X6B</programlisting>
            </example>
        </para>
        <para> But, there is enough information to fulfill the minimum 
            requirements of the 1D standard file format and
            also make an excellent example of a minimal 
            canSAS reduced 1-D SAS data file in XML.
        </para>
    </section>
    <section>
        <title>Procedure</title>
        <section>
            <title>make the basic XML file</title>
            <para> It is easiest to copy a template rather than start from an empty file. Copy the
                    <link xlink:href="http://svn.smallangles.net/svn/canSAS/1dwg/trunk/cansas1d.xml"
                        ><citetitle>cansas1d.xml</citetitle></link><footnote><para
                            ><link xlink:href="http://svn.smallangles.net/svn/canSAS/1dwg/trunk/cansas1d.xml">
                                <literal>http://svn.smallangles.net/svn/canSAS/1dwg/trunk/cansas1d.xml</literal>
                            </link></para></footnote> 
                file into your working directory and rename it to 
                <literal>collagen.xml</literal>. </para>
        </section>
        <section>
            <title>modify collagen.xml</title>
            <para> It is easier to see the metadata in the XML file before you enter the SAXS data
                into the file. With the brief metadata available, most of the other 
                lines in <citetitle>cansas1d.xml</citetitle> can be eliminated. This
                will result in a file that looks like the next example.</para>
            <example>
                <title><literal>collagen.xml</literal> with metadata but before data lines are added.</title>
                <programlisting language="xml" linenumbering="numbered">
                    <textobject>
                        <textdata fileref="example-collagen-predata.xml"/>
                    </textobject>
                </programlisting>
            </example>
        </section>
        <section>
            <title>prepare the SAXS data</title>
            <para> Microsoft Excel is used here to convert the table of SAXS data into the required
                lines of XML for the standard. Some may prefer to use a cell formula but here, we
                develop a bit of Excel Macro code to clarify our procedure. </para>
            <section>
                <title>Using Excel macros to reformat the SAXS data</title>
                <para> Within Excel, 
                    <indexterm>
                        <primary>binding</primary>
                        <secondary>Microsoft Excel</secondary>
                    </indexterm>
                    with the SAXS data in columns as shown in the Excel table
                    above, let's define the macros for our use. In Excel, type <emphasis role="bold"
                        >&lt;alt>&lt;F11></emphasis> to open the macro editing window. </para>
                <example>
                    <title>Microsoft Excel macro to format the <literal>Idata</literal> lines.</title>
                    <programlisting>
                        <textobject>
                            <textdata fileref="example-excel-macro.txt"/>
                        </textobject>
                    </programlisting>
                </example>
                <para> Your window will look similar to this one when you copy/paste the above example code:
                    (Yes, my spreadsheet is called <citetitle>MyFirstMacro.xls</citetitle>) </para>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="../../graphics/cs-collagen-macro-editing.jpg"
                            width="400pt" scalefit="1"/>
                    </imageobject>
                    <textobject>
                        <phrase>case study: Collagen, SAXS data in Excel chart</phrase>
                    </textobject>
                    <caption>
                        <para>case study: Collagen, SAXS data in Excel chart</para>
                    </caption>
                </mediaobject>
                <para> Now close the macro editing window and return to the SAXS data in the
                    spreadsheet. </para>
            </section>
            <section>
                <title>construct the Idata lines in XML</title>
                <para> move to spreadsheet cell <literal>E5</literal> and enter this
                    formula 
                    <informalexample>
                        <programlisting>=IDATA_tag(A5,$A$4,B5,$B$4,C5,$C$4)</programlisting>
                    </informalexample>
                </para>
                <para> Copy it down all rows in column <emphasis role="bold">E</emphasis> through
                    cell <literal>E335</literal>
                </para>
                <para> Select cells E5:E335 and copy to clipboard, then paste into 
                    <literal>collagen.xml</literal> document inside the 
                    <literal>SASdata</literal> element where you see the XML comment.
                </para>
            </section>
        </section>
    </section>
    <section>
        <title>Final Result</title>
        <para> A nicely-formatted display version of the final result can be viewed through the TRAC
            repository: <link
                xlink:href="http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/cs_collagen_full.xml">
                <citetitle>http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/cs_collagen_full.xml</citetitle>
            </link>
        </para>
    </section>
    <section>
        <title>Validate your file</title>
        <para> So you think you have an XML file. Let's validate it using the procedure from the
            documentation.All the instructions are on the documentation page. No sense in repeating
            them here. </para>
    </section>
    <section>
        <title>References</title>
        <para> All files are available at <link
                xlink:href="http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/examples/collagen/">
                <citetitle>http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/examples/collagen/</citetitle>
            </link>
        </para>
    </section>
</section>

