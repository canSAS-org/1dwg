<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbook.rng" type="xml"?>
<!-- 
    ########### SVN repository information ###################
    # $Date$
    # $Author$
    # $Revision$
    # $HeadURL$
    # $Id$
    ########### SVN repository information ###################
-->
<!-- from: http://www.smallangles.net/wgwiki/index.php/cansas1d_SASroot -->
<section xml:id="cansas1d_documentation-case_study-collagen" xmlns="http://docbook.org/ns/docbook"
    version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>Case Study: Dry Chick Collagen</title>
    <bridgehead> $Revision$ $Date$ </bridgehead>
    <section>
        <title>Overview</title>
        <para> To demonstrate how to get SAS data into the XML standard format, consider this set of
            SAXS data collected at the National Synchrotron Light Source, Brookhaven National
            Laboratory, using a SAXS camera set up temporarily at beam line X6B (operated by the
            Materials Science Division, Argonne National Lab). </para>
        <para> The sample was <emphasis role="bold">dry chick collagen.</emphasis> (Thanks to
            Malcolm Capel, NSLS beam line X12C for the sample.) </para>
        <para>
            <table>
                <title>Figures for dry chick collagen case study</title>
                <tgroup cols="2">
                    <tbody>
                        <row>
                            <entry>
                                <mediaobject>
                                    <imageobject>
                                        <imagedata
                                            fileref="../../graphics/cs-collagen-data-table-Excel.jpg"
                                            width="200pt" scalefit="1"/>
                                    </imageobject>
                                    <caption>
                                        <para>case study: Collagen, SAXS data in Excel table</para>
                                    </caption>
                                </mediaobject>
                            </entry>
                            <entry>
                                <mediaobject>
                                    <imageobject>
                                        <imagedata
                                            fileref="../../graphics/cs-collagen-saxs-chart-excel.jpg"
                                            width="200pt" scalefit="1"/>
                                    </imageobject>
                                    <caption>
                                        <para>case study: Collagen, SAXS data in Excel chart</para>
                                    </caption>
                                </mediaobject>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </para>
        <para> The raw data was collected on a linear position-sensitive detector and reduced to
            columns of <emphasis role="bold">Q</emphasis>, <emphasis role="bold">I</emphasis>, and
                <emphasis role="bold">Iesd</emphasis> (estimated standard deviation of <emphasis
                role="bold">I</emphasis>). </para>
        <para> The only metadata available for this data (without resorting to digging through piles
            of old notebooks) was obtained from two file headers: </para>
        <para>
            <link
                xlink:href="http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/examples/collagen/COLLAGEN.ASC">
                <citetitle>collagen.asc</citetitle>
            </link>
            <programlisting>Sep 19 1994     01:41:02 am     Elt: 00090 Seconds 
ID: No spectrum identifier defined
Memory Size: 8192 Chls  Conversion Gain: 1024  Adc Offset: 0000 Chls        </programlisting>
        </para>
        <para>
            <link
                xlink:href="http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/examples/collagen/collagen.saxs">
                <citetitle>collagen.saxs</citetitle>
            </link>
            <programlisting>dry chick collagen, d = 673 A
6531 eV, X6B</programlisting>
        </para>
        <para> But, the data can fulfill the minimum requirements of the 1D standard file formatand
            also make an excellent example of a minimalcanSAS reduced 1-D SAS data file in XML.
        </para>
    </section>
    <section>
        <title>Procedure</title>
        <section>
            <title>make the basic XML file</title>
            <para> It is easiest to copy a template rather than start from an empty file.Copy the
                    <link xlink:href="http://svn.smallangles.net/svn/canSAS/1dwg/trunk/cansas1d.xml">
                    <citetitle>cansas1d.xml</citetitle>
                </link> file into your working directory and rename it to <emphasis role="bold"
                    >collagen.xml</emphasis>. </para>
        </section>
        <section>
            <title>modify collagen.xml</title>
            <para> It is easier to see the metadata in the XML file before you enter the SAXS data
                into the file. With the brief metadata available, most lines can be eliminated.This
                will result in a file that looks like </para>
            <programlisting>&lt;?xml version="1.0"?>
&lt;?xml-stylesheet type="text/xsl" href="example.xsl" ?>
&lt;SASroot version="1.0"
    xmlns="cansas1d/1.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="cansas1d/1.0 http://svn.smallangles.net/svn/canSAS/1dwg/trunk/cansas1d.xsd"
    >
    &lt;SASentry>
    &lt;Title>dry chick collagen, d = 673 A, 6531 eV, X6B&lt;/Title>
        &lt;Run />
        &lt;SASdata>
            &lt;!-- Idata lines will go here -->
        &lt;/SASdata>
        &lt;SASsample>
            &lt;ID>dry chick collagen, d = 673 A, 6531 eV, X6B&lt;/ID>
        &lt;/SASsample>
        &lt;SASinstrument>
            &lt;name>X6B, NSLS, BNL&lt;/name>
            &lt;SASsource>
                &lt;radiation>X-ray synchrotron&lt;/radiation>
                &lt;wavelength unit="A">
                    1.898
                    &lt;!-- = 12398/6531 --> 
                &lt;/wavelength>
            &lt;/SASsource>
            &lt;SAScollimation />
            &lt;SASdetector>
                &lt;name>X6B PSD&lt;/name>
            &lt;/SASdetector>
        &lt;/SASinstrument>
        &lt;SASnote>
            Sep 19 1994     01:41:02 am     Elt: 00090 Seconds 
            ID: No spectrum identifier defined
            Memory Size: 8192 Chls  Conversion Gain: 1024  Adc Offset: 0000 Chls
            
            dry chick collagen, d = 673 A
            6531 eV, X6B
        &lt;/SASnote>
    &lt;/SASentry>
&lt;/SASroot></programlisting>
        </section>
        <section>
            <title>prepare the SAXS data</title>
            <para> Microsoft Excel is used here to convert the table of SAXS data into therequired
                lines of XML for the standard. Some may prefer to use a cell formula but here, we
                develop a bit of Excel Macro code to clarify our procedure. </para>
            <section>
                <title>Excel macros used</title>
                <para> Within Excel, with the SAXS data in columns as shown in the Excel table
                    above, let's define the macros for our use. In Excel, type <emphasis role="bold"
                        >&lt;alt>&lt;F11></emphasis> to open the macro editing window. </para>
                <programlisting>Function XML_tag(tag, attr, content) As String
  If attr = "" Then
    XML = "&lt;" &amp; tag &amp; ">"
  Else
  XML = "&lt;" &amp; tag &amp; " " &amp; attr &amp; ">"
  End If
  XML = XML &amp; content
  XML = XML &amp; "&lt;/" &amp; tag &amp; ">"
  XML_tag = XML
End Function

Function SAS_Idata_tag(element, unit, content) As String
XML = XML_tag(element, "unit=""" &amp; unit &amp; """", content)
  SAS_Idata_tag = XML
End Function

Function Idata_tag(Q, Q_unit, I, I_unit, Idev, Idev_unit) As String
  XML = SAS_Idata_tag("Q", Q_unit, Q)
  XML = XML &amp; SAS_Idata_tag("I", I_unit, I)
  XML = XML &amp; SAS_Idata_tag("Idev", Idev_unit, Idev)
  Idata_tag = XML_tag("Idata", "", XML)
End Function</programlisting>
                <para> Your window will look similar to this one when you copy/paste the above code:
                     (Yes, my spreadsheet is called MyFirstMacro.xls) </para>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="../../graphics/cs-collagen-macro-editing.jpg"
                            width="400pt" scalefit="1"/>
                    </imageobject>
                    <textobject>
                        <phrase>case study: Collagen, SAXS data in Excel chart</phrase>
                    </textobject>
                    <caption>
                        <para>case study: Collagen, SAXS data in Excel chart</para>
                    </caption>
                </mediaobject>
                <para> Now close the macro editing window and return to the SAXS data in the
                    spreadsheet. </para>
            </section>
            <section>
                <title>construct the Idata lines in XML</title>
                <para> move to spreadsheet cell <emphasis role="bold">E5</emphasis> and enter this
                    formula <programlisting>=IDATA_tag(A5,$A$4,B5,$B$4,C5,$C$4)</programlisting>
                </para>
                <para> Copy it down all rows in column <emphasis role="bold">E</emphasis> through
                    cell <emphasis role="bold">E335</emphasis>
                </para>
                <para> Select cells E5:E335 and copy to clipboard, then paste into <emphasis
                        role="bold">collagen.xml</emphasis> document inside the <emphasis
                        role="bold">SASdata</emphasis> element where you see the XML comment .
                </para>
            </section>
        </section>
    </section>
    <section>
        <title>Final Result</title>
        <para> A nicely-formatted display version of the final result can be viewed through the TRAC
            repository: <link
                xlink:href="http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/cs_collagen_full.xml">
                <citetitle>http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/cs_collagen_full.xml</citetitle>
            </link>
        </para>
    </section>
    <section>
        <title>Validate your file</title>
        <para> So you think you have an XML file. Let's validate it using the procedure from the
            documentation.All the instructions are on the documentation page. No sense in repeating
            them here. </para>
    </section>
    <section>
        <title>References</title>
        <para> All files are available at <link
                xlink:href="http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/examples/collagen/">
                <citetitle>http://svn.smallangles.net/trac/canSAS/browser/1dwg/trunk/examples/collagen/</citetitle>
            </link>
        </para>
    </section>
</section>

